\documentclass{scrartcl}

\usepackage{multirow}

\usepackage{listings}
\lstset{basicstyle=\footnotesize\ttfamily}

\usepackage{tikz}
\usepackage{pgf-umlsd}

\usepgflibrary{arrows} % for pgf-umlsd

\title{MUSTE server protocol}
\author{Herbert Lange}
\date{Document version 0.0.1}
\begin{document}
\maketitle

\section{Design principles}

\begin{itemize}
\item stateful - authentication happens once
\item unidirectional - client sends request, server answers
\end{itemize}

\section{Message format}

\begin{itemize}
\item Client messages (CM) are messages from the client sent to the server

  \begin{tabular}{llp{0.6\textwidth}}
    Message Name                      & Valid Responses   & Description \\
    \hline
    \multirow{2}{*}{CMLoginRequest}   & SMLoginSuccessful & \multirow{2}{*}{Send login request} \\
                                      & SMLoginFailed \\
    \hline
    \multirow{2}{*}{CMMOTDRequest}    & SMMOTDResponse    & \multirow{2}{0.6\textwidth}{Request a Message-of-the-day, e.g. the user survey from the server} \\
                                      & SMSessionInvalid \\
    \hline
    \multirow{3}{*}{CMDataResponse}   & SMDataReceived    & \multirow{3}{*}{Send result of the survey} \\
                                      & SMDataInvalid \\
                                      & SMSessionInvalid \\
    \hline
    \multirow{2}{*}{CMLessonsRequest} & SMLessonsList     & \multirow{2}{*}{Request available lessons} \\
                                      & SMSessionInvalid \\
    \hline
    \multirow{3}{*}{CMMenuRequest}    & SMMenuList        & \multirow{3}{*}{Send request for menus} \\
                                      & SMLessonInvalid \\
                                      & SMSessionInvalid \\
  \hline
\end{tabular}

\item Server messages (SM) are messages from the servert sent to a client

  \begin{tabular}{ll}
    Message Name      & Description \\
    \hline
    SMLoginSuccessful & Login successful \\
    SMLoginFailed     & Login failed \\
    SMMOTDResponse    & A potential html-fragment for a message of the day \\
    SMSessionInvalid  & Invalid Session \\
    SMLessonsList     & Lesson listing \\
    SMLessonInvalid   & Invalid lesson \\
    SMDataReceived    & Data received \\
    SMDataInvalid     & Invalid data
  \end{tabular}

\end{itemize}

\end{tabular}
\section{Sequences}
Login error:
\begin{sequencediagram}
  \newthread{server}{Ajax-Server}{Server}

  \newthread{client}{Web-Client}{Client}
  
  \begin{call}{client}{\shortstack{CM001\\username\\password}}{server}{SM002}
  \end{call}

\end{sequencediagram}

\end{document}
